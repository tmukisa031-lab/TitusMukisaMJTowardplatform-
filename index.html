<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Universal Media Hub</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#eee; text-align:center; margin:0; padding:0; }
h1,h2 { color:#0ff; margin:10px 0; }
.section { margin:20px auto; padding:15px; background:#222; border-radius:12px; width:90%; max-width:1000px; box-shadow:0 0 15px rgba(0,0,0,0.5); position:relative; }
input, select { width:95%; margin:8px 0; padding:8px; border-radius:8px; border:none; }
video, audio { width:100%; margin-top:10px; border-radius:8px; background:#000; max-height:1100px; }
.remote { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; gap:6px; }
.remote button { padding:10px 14px; border:none; border-radius:8px; background:#333; color:#0ff; cursor:pointer; font-size:14px; }
.remote button:hover { background:#0ff; color:#000; }
#guideOverlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; flex-direction:column; justify-content:center; align-items:center; color:#0ff; font-size:20px; font-weight:bold; text-shadow:2px 2px 4px #000; }
#guideOverlay img { max-width:90%; max-height:70%; margin-bottom:10px; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.8); }
#guideOverlay button { margin-top:12px; padding:8px 16px; border:none; border-radius:8px; background:#0ff; color:#000; cursor:pointer; }
.tv-frame { width:100%; max-width:1000px; max-height:600px; background:#111; border:15px solid #333; border-radius:15px; box-shadow:0 0 40px rgba(0,0,0,0.8); overflow:hidden; position:relative; margin:0 auto; }
#timerDisplay { font-size: 18px; font-weight: bold; color: #ff6600; margin-bottom: 10px; }
</style>
</head>
<body>
<h1>üåç Universal Media Hub</h1>

<!-- Timer -->
<div id="timerDisplay">‚è≥ Time Left: 0h 0m 0s</div>

<!-- TV / IPTV Section -->
<div class="section">
  <h2>üì∫ TV / IPTV</h2>
  <input type="text" id="tvSearch" placeholder="Search TV channel..." onkeyup="searchTV()">
  <select id="tvSelect" size="6" onchange="playTV()"></select>
  <div class="tv-frame">
    <video id="tvPlayer" controls></video>
    <div id="guideOverlay" style="display:none;">
      <img id="guideImg" src="" alt="Guide Slide">
      <div id="guideText"></div>
      <button onclick="stopGuide()">Close Guide</button>
    </div>
  </div>
  <div class="remote">
    <button onclick="prevTV()">‚èÆ Prev</button>
    <button onclick="playTV()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseTV()">‚è∏ Pause</button>
    <button onclick="stopTV()">‚èπ Stop</button>
    <button onclick="toggleMuteTV()">üîá Mute</button>
    <button onclick="nextTV()">‚è≠ Next</button>
    <button onclick="switchToGuide()">üì∫ Guide</button>
    <!-- Numeric keypad -->
    <button onclick="pressNumber(1)">1</button>
    <button onclick="pressNumber(2)">2</button>
    <button onclick="pressNumber(3)">3</button>
    <button onclick="pressNumber(4)">4</button>
    <button onclick="pressNumber(5)">5</button>
    <button onclick="pressNumber(6)">6</button>
    <button onclick="pressNumber(7)">7</button>
    <button onclick="pressNumber(8)">8</button>
    <button onclick="pressNumber(9)">9</button>
    <button onclick="pressNumber(0)">0</button>
    <button onclick="goToChannel()">Enter</button>
    <button onclick="infoTV()">‚ÑπÔ∏è Info</button>
  </div>
</div>

<!-- FM Section -->
<div class="section">
  <h2>üìª FM Radio</h2>
  <input type="text" id="fmSearch" placeholder="Search FM station..." onkeyup="searchFM()">
  <select id="fmSelect" size="6" onchange="playFM()"></select>
  <audio id="fmPlayer" controls></audio>
  <div class="remote">
    <button onclick="prevFM()">‚èÆ Prev</button>
    <button onclick="playFM()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseFM()">‚è∏ Pause</button>
    <button onclick="stopFM()">‚èπ Stop</button>
    <button onclick="toggleMuteFM()">üîá Mute</button>
    <button onclick="nextFM()">‚è≠ Next</button>
  </div>
</div>

<!-- Audio Section -->
<div class="section">
  <h2>üé∂ Audio / Music</h2>
  <input type="text" id="audioSearch" placeholder="Search audio..." onkeyup="searchAudio()">
  <input type="file" id="audioUpload" accept="audio/*" onchange="uploadAudio()">
  <select id="audioSelect" size="6" onchange="playAudio()"></select>
  <audio id="audioPlayer" controls></audio>
  <button onclick="downloadAudio()">‚¨á Download Selected</button>
</div>

<!-- Video Section -->
<div class="section">
  <h2>üé• Video / Movies</h2>
  <input type="text" id="videoSearch" placeholder="Search video..." onkeyup="searchVideo()">
  <input type="file" id="videoUpload" accept="video/*" onchange="uploadVideo()">
  <select id="videoSelect" size="6" onchange="playVideo()"></select>
  <video id="videoPlayer" controls></video>
  <button onclick="downloadVideo()">‚¨á Download Selected</button>
</div>

<!-- Subscription Section -->
<div class="section">
  <h2>üí≥ Subscription Access</h2>
  <p>Select a plan to unlock premium IPTV & Radio channels:</p>
  <a href="javascript:void(0);" onclick="payPlan('1d',1000)"><button>üìÜ 1 Day (UGX 1000)</button></a>
  <a href="javascript:void(0);" onclick="payPlan('1w',5000)"><button>üóì 1 Week (UGX 5000)</button></a>
  <a href="javascript:void(0);" onclick="payPlan('1m',15000)"><button>üóì 1 Month (UGX 15000)</button></a>
  <button onclick="payUnlimited()">‚ôæ Unlimited (UGX 45.5/hour)</button>
  <p id="subStatus">Status: Free Mode</p>
</div>

<!-- User Stats -->
<div id="userStats">
  üë• Total Users: <span id="totalUsers">0</span> | üü¢ Active Users: <span id="activeUsers">0</span>
</div>

<script>
// ====== Config ======
const merchantID = "465914";
const ratePerHour = 45.5;
let subscribed=false, activationTime=null, expiryTime=null, timerInterval;

// ====== Media Lists ======
let tvChannels=[
  {name:"Guide Channel", url:"guide"},  
  { name: "BBC News", url: "https://bbcmedia.ic.llnwd.net/stream/bbcmedia_bbcnews_mf_p" },
  { name: "CNN International", url: "https://cnn-cnninternational-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "Guide Channel", url: "guide" },
  { name: "Local Free Channel", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" },
  { name: "Dailymotion Live", url: "https://stream-02.sg1.dailymotion.com/sec(_9ERdF8LSeW4DLU4w9GjmRJm)/dm/3/x2j4h6b/live.m3u8" },
  { name: "BBC News", url: "https://bbcmedia.ic.llnwd.net/stream/bbcmedia_bbcnews_mf_p" },
  { name: "DW News", url: "https://dwstream3-lh.akamaihd.net/i/dwstream3_live@124409/master.m3u8" },
  { name: "Al Jazeera English", url: "https://live-hls-web-aje.getaj.net/AJE/01.m3u8" },
  { name: "France 24 English", url: "https://static.france24.com/live/F24_EN_HI_HLS/live_web.m3u8" },
  { name: "Sky News", url: "https://siloh.pluto.tv/lilo/production/SkyNews/master.m3u8" },
  { name: "CNN Fast", url: "https://cnn-cnninternational-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "Bloomberg Television", url: "https://bloomberg-bloomberg-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "Red Bull TV", url: "https://rbmn-live.akamaized.net/hls/live/590964/BoRB-AT/master_3360.m3u8" },
  { name: "Trace Sports Stars", url: "https://lightning-tracesport-intl-samsungnz.amagi.tv/playlist.m3u8" },
  { name: "FIFA+ Channel", url: "https://bcovlive-a.akamaihd.net/ffe4b8b40db34d52b8c7a9d8c8f60a7f/eu-central-1/6057952919001/playlist.m3u8" },
  { name: "X Sports", url: "https://dai2.xumo.com/amagi_hls_data_xumo1212A-x-sports/CDN/playlist.m3u8" },
  { name: "Fuel TV", url: "https://fueltv-fueltv-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "MovieSphere", url: "https://moviesphere-samsungus.amagi.tv/playlist.m3u8" },
  { name: "FilmRise Movies", url: "https://dai.google.com/linear/hls/event/fKf2zcnOTY2M0UdtbfxHqQ/master.m3u8" },
  { name: "Plex Action Zone", url: "https://stream.ads.ottera.tv/playlist.m3u8?network_id=789" },
  { name: "Classic Cinema", url: "https://classiccinema-amd-global.fast.anvato.net/amc/cnn/clsc/master.m3u8" },
  { name: "Bukedde TV", url: "https://livestream.bukedde.co.ug/live/bukeddetv.m3u8" },
  { name: "NTV Uganda", url: "https://ntv.akamaized.net/hls/live/2007531/ntvug/playlist.m3u8" },
  { name: "UBC Uganda", url: "https://cdn.moderntv.eu/live/ubc/playlist.m3u8" },
  { name: "BBS Terefayina", url: "https://edge01.bbstv.co.ug/live/bbstv.m3u8" },
  { name: "TV West", url: "https://edge02.visiongroup.co.ug/live/tvwest.m3u8" },
  { name: "Trace Urban", url: "https://lightning-traceurban-samsungau.amagi.tv/playlist.m3u8" },
  { name: "Trace Africa", url: "https://lightning-traceafrica-samsungau.amagi.tv/playlist.m3u8" },
  { name: "FashionTV", url: "https://fashiontv-fashiontv-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "MTV Live", url: "https://pluto-live.plutotv.net/egress/broker/us-east/mtv_live/playlist.m3u8" },
  { name: "Vevo Pop", url: "https://dai2.xumo.com/amagi_hls_data_xumo1212A-vevo-pop/CDN/playlist.m3u8" },
  { name: "MTV Classic", url: "https://pluto-live.plutotv.net/egress/broker/us-east/mtv_classic/playlist.m3u8" },
  { name: "Trace Gospel", url: "https://lightning-tracegospel-samsungnz.amagi.tv/playlist.m3u8" },
  { name: "Toon Goggles", url: "https://toongoggles-toongoggles-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "PBS Kids", url: "https://2-fss-1.streamhoster.com/pl_140/amlst:200914-1298290/playlist.m3u8" },
  { name: "Happy Kids TV", url: "https://happykidsjunior-vizio.amagi.tv/playlist.m3u8" },
  { name: "NASA TV", url: "https://ntv1.akamaized.net/hls/live/2014075/NASA-Public/master.m3u8" },
  { name: "National Geographic Wild", url: "https://dai.google.com/linear/hls/event/NATGEO_WILD/master.m3u8" },
  { name: "CGTN Documentary", url: "https://news.cgtn.com/resource/live/document/cgtn-doc.m3u8" },
  { name: "TBN Africa", url: "https://tbn-tn-1-eu.rakuten.wurl.tv/playlist.m3u8" },
  { name: "Daystar", url: "https://daystar-1-us.samsung.wurl.tv/playlist.m3u8" },
  { name: "Emmanuel TV", url: "https://api.new.livestream.com/accounts/23664978/events/7337715/live.m3u8" },
  { name: "Bloomberg Originals", url: "https://bloomberg-bloomberg-1-gb.samsung.wurl.tv/playlist.m3u8" },{ name: "BBC News", url: "https://bbcmedia.ic.llnwd.net/stream/bbcmedia_bbcnews_mf_p" },

{ name: "CNN International", url: "https://cnn-cnninternational-1-eu.rakuten.wurl.tv/playlist.m3u8" },

{ name: "DW News", url: "https://dwstream3-lh.akamaihd.net/i/dwstream3_live@124409/master.m3u8" },

{ name: "Al Jazeera English", url: "https://live-hls-web-aje.getaj.net/AJE/01.m3u8" },

{ name: "France 24 English", url: "https://static.france24.com/live/F24_EN_HI_HLS/live_web.m3u8" },

{ name: "Sky News", url: "https://siloh.pluto.tv/lilo/production/SkyNews/master.m3u8" },

{ name: "Bloomberg TV", url: "https://bloomberg-bloomberg-1-eu.rakuten.wurl.tv/playlist.m3u8" },

{ name: "Red Bull TV", url: "https://rbmn-live.akamaized.net/hls/live/590964/BoRB-AT/master_3360.m3u8" },

{ name: "FIFA+", url: "https://bcovlive-a.akamaihd.net/ffe4b8b40db34d52b8c7a9d8c8f60a7f/eu-central-1/6057952919001/playlist.m3u8" },

{ name: "MTV Live", url: "https://pluto-live.plutotv.net/egress/broker/us-east/mtv_live/playlist.m3u8" },

{ name: "Trace Urban", url: "https://lightning-traceurban-samsungau.amagi.tv/playlist.m3u8" },

{ name: "Trace Africa", url: "https://lightning-traceafrica-samsungau.amagi.tv/playlist.m3u8" },

{ name: "Fashion TV", url: "https://fashiontv-fashiontv-1-eu.rakuten.wurl.tv/playlist.m3u8" },

{ name: "NASA TV", url: "https://ntv1.akamaized.net/hls/live/2014075/NASA-Public/master.m3u8" },

{ name: "National Geographic Wild", url: "https://dai.google.com/linear/hls/event/NATGEO_WILD/master.m3u8" },

{ name: "PBS Kids", url: "https://2-fss-1.streamhoster.com/pl_140/amlst:200914-1298290/playlist.m3u8" },

{ name: "Happy Kids TV", url: "https://happykidsjunior-vizio.amagi.tv/playlist.m3u8" },

{ name: "Bukedde TV", url: "https://livestream.bukedde.co.ug/live/bukeddetv.m3u8" },

{ name: "NTV Uganda", url: "https://ntv.akamaized.net/hls/live/2007531/ntvug/playlist.m3u8" },

{ name: "UBC Uganda", url: "https://cdn.moderntv.eu/live/ubc/playlist.m3u8" }


];

let fmStations=[
  { name: "NPR News", url: "https://npr-ice.streamguys1.com/live.mp3" },
  { name: "BBC Radio 1", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_one" },
  { name: "NPR News", url: "https://npr-ice.streamguys1.com/live.mp3" },
  { name: "BBC Radio 1", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_one" },
  { name: "BBC Radio 2", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_two" },
  { name: "BBC Radio 3", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_three" },
  { name: "BBC Radio 4", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_fourfm" },
  { name: "BBC World Service", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_world_service" },
  { name: "Classic FM UK", url: "http://media-ice.musicradio.com/ClassicFMMP3" },
  {name:"Kiss FM", url:"http://kissfm-uk.radio.co/sd/live.mp3"},
  {name:"Radio One", url:"http://radio1-uk.radio.co/sd/live.mp3"},
  {name:"Classic FM", url:"http://media-ice.musicradio.com/ClassicFMMP3"},
  { name: "Radio France FIP", url: "https://direct.fipradio.fr/live/fip-midfi.mp3" },
  { name: "Radio Nova 100FM Ireland", url: "https://ncr-live-icecast.scdn.arkena.com/nova100fm-mp3" },
  { name: "NRJ France", url: "http://cdn.nrjaudio.fm/audio1/fr/30001/mp3_128.mp3" },
  { name: "Deutschlandfunk", url: "https://st01.sslstream.dlf.de/dlf/01/128/mp3" },
  { name: "Smooth Jazz Florida", url: "https://us2.internet-radio.com/proxy/smoothjazzflorida?mp=/stream" },
  { name: "KEXP 90.3 Seattle", url: "https://kexp-mp3-128.streamguys1.com/kexp128.mp3" },
  { name: "WBGO Jazz 88.3 Newark", url: "https://wbgo.streamguys1.com/wbgo128.mp3" },
  { name: "Radio Disney USA", url: "http://streaming.radioservice.com:8000/radiodisney" },
  { name: "Chicago Public Radio", url: "https://chicagopublicradio.streamguys1.com/wbez128.mp3" },
  { name: "Capital FM USA", url: "https://capitalfm-usa.streamguys1.com/capitalfm128.mp3" },
  { name: "Jazz24 Seattle", url: "https://live.wostreaming.net/direct/ppm-jazz24mp3-ibc1" },
  { name: "iHeartRadio Pop Hits", url: "https://playerservices.streamtheworld.com/api/livestream-redirect/IHR_POP_HITS.mp3" },
  { name: "Radio Paradise", url: "https://stream.radioparadise.com/mp3-192" },
  { name: "Capital FM Uganda", url: "https://stream.zeno.fm/ssn0z7z0qd0uv" },
  { name: "CBS FM Buganda", url: "https://stream.zeno.fm/qnydx59r0ueuv" },
  { name: "Galaxy FM Uganda", url: "https://stream.zeno.fm/k5c1a4y9r0uev" },
  { name: "91.3 KFM Uganda", url: "https://stream.zeno.fm/ys7dr9x8r0uev" },
  { name: "Radio One Uganda", url: "https://radioonefm.ug/stream" },
  { name: "Power FM Uganda", url: "https://stream.zeno.fm/x9w3k2j2r0uev" },
  { name: "Beat FM Uganda", url: "https://stream.zeno.fm/beatfmuganda" },
  { name: "Baba FM Uganda", url: "https://stream.zeno.fm/babafm" },
  { name: "Splash FM Uganda", url: "https://stream.zeno.fm/splashfm" },
  { name: "Radio West Uganda", url: "https://stream.zeno.fm/radiowest" },
  { name: "ABC Radio Australia", url: "http://abc.net.au/res/stream/live/mp3" },
  { name: "NHK World Japan", url: "http://nhk-world.streamguys1.com/nhk_world_japan.mp3" },
  { name: "Radio India", url: "http://www.radioindiaonline.com:8000/live" },
  { name: "Dubai Eye 103.8", url: "http://icecast1.playoutsolution.com:8000/dubaieye" },
  { name: "Radio Pakistan", url: "http://radio.gov.pk:8000/live" },
  { name: "Radio China International", url: "http://crlive.cri.cn/cri4.m3u" },
  { name: "Radio Cultura Brazil", url: "http://200.136.27.12:8000/live" },
  { name: "Radio Nacional Chile", url: "http://radio.uchile.cl:8000/live" },
  { name: "Radio Caracol Colombia", url: "http://radios.caracoltv.com:8000/live" },
  { name: "Radio Mitre Argentina", url: "http://s4.mitreweb.com.ar:8000/live" },
  { name: "Radio Rebelde Cuba", url: "http://streaming.rebelde.cu:8000/live" },
  { name: "Radio Garden Global Mix", url: "https://listen.radiogarden.com/live" },
  { name: "TuneIn Global", url: "https://tunein.com/radio/Internet-Radio-c197066/" },
  { name: "Radio Italia Solo Musica", url: "http://icecast.radioitalia.it/RadioItaliaSoloMusica.mp3" },
  { name: "Radio 24 Italy", url: "http://stream.radio24.it/live.mp3" },
  { name: "SomaFM Groove Salad", url: "https://somafm.com/groovesalad.pls" },
  { name: "SomaFM Drone Zone", url: "https://somafm.com/dronezone.pls" },
  { name: "SomaFM Lush", url: "https://somafm.com/lush.pls" },
  { name: "Radio Caprice Classical", url: "http://radcap.ru:8000/classical" },
  { name: "Radio Caprice Jazz", url: "http://radcap.ru:8000/jazz" },
  { name: "Radio Caprice Rock", url: "http://radcap.ru:8000/rock" },
  { name: "Radio Caprice Pop", url: "http://radcap.ru:8000/pop" },{ name: "BBC Radio 1", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_one" },

{ name: "BBC Radio 2", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_two" },

{ name: "BBC Radio 3", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_three" },

{ name: "BBC Radio 4", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_radio_fourfm" },

{ name: "BBC World Service", url: "https://stream.live.vc.bbcmedia.co.uk/bbc_world_service" },

{ name: "NPR News", url: "https://npr-ice.streamguys1.com/live.mp3" },

{ name: "Classic FM UK", url: "http://media-ice.musicradio.com/ClassicFMMP3" },

{ name: "Radio France FIP", url: "https://direct.fipradio.fr/live/fip-midfi.mp3" },

{ name: "NRJ France", url: "http://cdn.nrjaudio.fm/audio1/fr/30001/mp3_128.mp3" },

{ name: "Deutschlandfunk", url: "https://st01.sslstream.dlf.de/dlf/01/128/mp3" },

{ name: "Smooth Jazz Florida", url: "https://us2.internet-radio.com/proxy/smoothjazzflorida?mp=/stream" },

{ name: "KEXP 90.3 Seattle", url: "https://kexp-mp3-128.streamguys1.com/kexp128.mp3" },

{ name: "WBGO Jazz 88.3 Newark", url: "https://wbgo.streamguys1.com/wbgo128.mp3" },

{ name: "Capital FM Uganda", url: "https://stream.zeno.fm/ssn0z7z0qd0uv" },

{ name: "CBS FM Buganda", url: "https://stream.zeno.fm/qnydx59r0ueuv" },

{ name: "Galaxy FM Uganda", url: "https://stream.zeno.fm/k5c1a4y9r0uev" },

{ name: "91.3 KFM Uganda", url: "https://stream.zeno.fm/ys7dr9x8r0uev" },

{ name: "Radio One Uganda", url: "https://radioonefm.ug/stream" },

{ name: "Power FM Uganda", url: "https://stream.zeno.fm/x9w3k2j2r0uev" },

{ name: "Beat FM Uganda", url: "https://stream.zeno.fm/beatfmuganda" },

{ name: "Baba FM Uganda", url: "https://stream.zeno.fm/babafm" },

{ name: "Splash FM Uganda", url: "https://stream.zeno.fm/splashfm" },

{ name: "Radio West Uganda", url: "https://stream.zeno.fm/radiowest" },

{ name: "NHK World Japan", url: "http://nhk-world.streamguys1.com/nhk_world_japan.mp3" },

{ name: "Radio Disney USA", url: "http://streaming.radioservice.com:8000/radiodisney" },

{ name: "Chicago Public Radio", url: "https://chicagopublicradio.streamguys1.com/wbez128.mp3" },

{ name: "Jazz24 Seattle", url: "https://live.wostreaming.net/direct/ppm-jazz24mp3-ibc1" },

{ name: "iHeartRadio Pop Hits", url: "https://playerservices.streamtheworld.com/api/livestream-redirect/IHR_POP_HITS.mp3" },

{ name: "Radio Paradise", url: "https://stream.radioparadise.com/mp3-192" }


];

let audioTracks=[], videoClips=[];

// ====== Load Media Lists ======
function loadLists(){
  const tvSel=document.getElementById("tvSelect"); tvSel.innerHTML="";
  tvChannels.forEach(c=>tvSel.add(new Option(c.name,c.url)));
  const fmSel=document.getElementById("fmSelect"); fmSel.innerHTML="";
  fmStations.forEach(s=>fmSel.add(new Option(s.name,s.url)));
  refreshAudio(); refreshVideo();
}

// ====== Search ======
function searchTV(){ filterSelect("tvSearch","tvSelect",tvChannels); }
function searchFM(){ filterSelect("fmSearch","fmSelect",fmStations); }
function searchAudio(){ filterSelect("audioSearch","audioSelect",audioTracks); }
function searchVideo(){ filterSelect("videoSearch","videoSelect",videoClips); }

function filterSelect(searchId,selectId,list){
  const q=document.getElementById(searchId).value.toLowerCase();
  const sel=document.getElementById(selectId); sel.innerHTML="";
  list.filter(x=>x.name.toLowerCase().includes(q)).forEach(x=>sel.add(new Option(x.name,x.url)));
}

// ====== TV Controls ======
let tvIndex=0, tvPlayer=document.getElementById("tvPlayer"), numBuffer="";
function playTV() {
  if(!checkAccess()) return;
  const sel=document.getElementById("tvSelect");
  tvIndex=sel.selectedIndex;
  const url=sel.value;
  if(url==="guide"){ startGuide(); return; } else { stopGuide(); }
  tvPlayer.src=url; tvPlayer.play();
}
function pauseTV(){ tvPlayer.pause(); }
function stopTV(){ tvPlayer.pause(); tvPlayer.currentTime=0; }
function toggleMuteTV(){ tvPlayer.muted=!tvPlayer.muted; }
function nextTV(){ tvIndex=(tvIndex+1)%tvChannels.length; document.getElementById("tvSelect").selectedIndex=tvIndex; playTV(); }
function prevTV(){ tvIndex=(tvIndex-1+tvChannels.length)%tvChannels.length; document.getElementById("tvSelect").selectedIndex=tvIndex; playTV(); }
function pressNumber(n){ numBuffer+=n; }
function goToChannel(){ let idx=parseInt(numBuffer)-1; if(idx>=0 && idx<tvChannels.length){ tvIndex=idx; document.getElementById("tvSelect").selectedIndex=idx; playTV(); } numBuffer=""; }
function infoTV(){ alert("Channel Info: "+tvChannels[tvIndex].name); }

// ====== Guide Channel ======
let guideSlides=[
  {img:"https://picsum.photos/800/400?random=1", text:"Welcome to the Guide Channel!"},
  {img:"https://picsum.photos/800/400?random=2", text:"Use the Remote to control your media easily."},
  {img:"https://picsum.photos/800/400?random=3", text:"Upload and download your own audio & video."},
  {img:"https://picsum.photos/800/400?random=4", text:"Subscribe for premium channels. Enter 6 digits merchant id/code: 465914."},
  {img:"https://picsum.photos/800/400?random=5", text:"Enjoy movies, music, TV & FM in one hub."}
];
let guideIndex=0, guideTimer;
function startGuide(){
  stopGuide();
  document.getElementById("guideOverlay").style.display="flex";
  showGuideSlide();
}
function showGuideSlide(){
  const slide=guideSlides[guideIndex];
  document.getElementById("guideImg").src=slide.img;
  document.getElementById("guideText").innerText=slide.text;
  guideIndex=(guideIndex+1)%guideSlides.length;
  guideTimer=setTimeout(showGuideSlide,4000);
}
function stopGuide(){ clearTimeout(guideTimer); document.getElementById("guideOverlay").style.display="none"; }
function switchToGuide(){ document.getElementById("tvSelect").selectedIndex=0; playTV(); }

// ====== FM Controls ======
let fmIndex=0, fmPlayer=document.getElementById("fmPlayer");
function playFM() {
  if(!checkAccess()) return;
  const sel=document.getElementById("fmSelect");
  fmIndex=sel.selectedIndex;
  fmPlayer.src=sel.value;
  fmPlayer.play();
}
function pauseFM(){ fmPlayer.pause(); }
function stopFM(){ fmPlayer.pause(); fmPlayer.currentTime=0; }
function toggleMuteFM(){ fmPlayer.muted=!fmPlayer.muted; }
function nextFM(){ fmIndex=(fmIndex+1)%fmStations.length; document.getElementById("fmSelect").selectedIndex=fmIndex; playFM(); }
function prevFM(){ fmIndex=(fmIndex-1+fmStations.length)%fmStations.length; document.getElementById("fmSelect").selectedIndex=fmIndex; playFM(); }

// ====== Audio/Video Upload & Play ======
const audioPlayer=document.getElementById("audioPlayer");
const videoPlayer=document.getElementById("videoPlayer");
function uploadAudio(){ const file=document.getElementById("audioUpload").files[0]; if(file){ const url=URL.createObjectURL(file); audioTracks.push({name:file.name,url}); refreshAudio(); } }
function uploadVideo(){ const file=document.getElementById("videoUpload").files[0]; if(file){ const url=URL.createObjectURL(file); videoClips.push({name:file.name,url}); refreshVideo(); } }
function refreshAudio(){ let sel=document.getElementById("audioSelect"); sel.innerHTML=""; audioTracks.forEach(a=>sel.add(new Option(a.name,a.url))); }
function refreshVideo(){ let sel=document.getElementById("videoSelect"); sel.innerHTML=""; videoClips.forEach(v=>sel.add(new Option(v.name,v.url))); }
function playAudio(){ if(!checkAccess()) return; audioPlayer.src=document.getElementById("audioSelect").value; audioPlayer.play(); }
function playVideo(){ if(!checkAccess()) return; videoPlayer.src=document.getElementById("videoSelect").value; videoPlayer.play(); }
function forceDownload(url,name){ const a=document.createElement("a"); a.href=url; a.download=name||"media"; a.click(); }
function downloadAudio(){ let sel=document.getElementById("audioSelect"); if(sel.value) forceDownload(sel.value, sel.options[sel.selectedIndex].text); }
function downloadVideo(){ let sel=document.getElementById("videoSelect"); if(sel.value) forceDownload(sel.value, sel.options[sel.selectedIndex].text); }

// ====== Subscription ======
function payPlan(plan, amount){
  const code=`*165*3*1*${merchantID}*${amount}#`;
  if(confirm(`Confirm payment of UGX ${amount} for ${plan.toUpperCase()} plan?`)){
    window.location.href='tel:'+code;
    activateSubscription(plan, amount);
  }
}

function payUnlimited(){
  const amount=parseFloat(prompt("Enter amount to pay for Unlimited Plan (UGX 45.5 per hour):"));
  if(isNaN(amount)||amount<=0){ alert("Invalid amount"); return; }
  const hours=amount/ratePerHour;
  alert(`You are paying UGX ${amount.toFixed(0)} for ~${hours.toFixed(1)} hours of access.`);
  const momoLink=`tel:*165*3*1*${merchantID}*${amount.toFixed(0)}#`;
  const a=document.createElement("a"); a.href=momoLink; a.style.display="none"; document.body.appendChild(a); a.click(); document.body.removeChild(a);
  activateSubscription("unlimited",amount);
}

function activateSubscription(plan, amount){
  const now=new Date();
  expiryTime=new Date();
  if(plan==="1d") expiryTime.setHours(now.getHours()+24);
  else if(plan==="1w") expiryTime.setDate(now.getDate()+7);
  else if(plan==="1m") expiryTime.setMonth(now.getMonth()+1);
  else if(plan==="unlimited") expiryTime.setHours(now.getHours()+(amount/ratePerHour));
  activationTime=now;
  subscribed=true;
  localStorage.setItem("subscriptionData",JSON.stringify({plan,expiry:expiryTime.toISOString()}));
  updateStatus();
  startTimer();
  updateUserCounts(true);
  alert("‚úÖ Subscription activated!");
}

function checkStoredSubscription(){
  const saved=localStorage.getItem("subscriptionData");
  if(!saved){ statusElement.innerText="Status: Free Mode"; return; }
  const data=JSON.parse(saved);
  if(new Date()>new Date(data.expiry)){ localStorage.removeItem("subscriptionData"); statusElement.innerText="Status: Expired ‚Äî Please Renew"; subscribed=false; } 
  else { subscribed=true; expiryTime=new Date(data.expiry); updateStatus(); startTimer(); }
}

function checkAccess(){
  if(!subscribed || !expiryTime || new Date()>expiryTime){ alert("üö´ Access denied. Please subscribe first."); return false; }
  return true;
}

// ====== Timer ======
function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(!expiryTime) return;
    let remaining=expiryTime-Date.now();
    if(remaining<=0){
      clearInterval(timerInterval);
      subscribed=false;
      localStorage.removeItem("subscriptionData");
      statusElement.innerText="Status: Expired";
      document.getElementById("timerDisplay").innerText="‚è≥ Subscription Expired";
      alert("Your subscription has expired. Please renew.");
      tvPlayer.pause(); fmPlayer.pause();
      updateUserCounts(false);
      return;
    }
    let hrs=Math.floor(remaining/3600000);
    let mins=Math.floor((remaining%3600000)/60000);
    let secs=Math.floor((remaining%60000)/1000);
    document.getElementById("timerDisplay").innerText=`   ‚è≥ Time Left: ${hrs}h ${mins}m ${secs}s`;
  },1000);
}

// ====== Status & Users ======
const statusElement=document.getElementById("subStatus");
function updateStatus(){ statusElement.innerText=`Status: Subscribed (${subscribed ? "Active" : "Expired"})`; }
function loadUserStats() {
  const total = parseInt(localStorage.getItem("totalUsers")) || 0;
  const active = parseInt(localStorage.getItem("activeUsers")) || 0;
  document.getElementById("totalUsers").innerText = total;
  document.getElementById("activeUsers").innerText = active;
}

function updateUserCounts(onSubscribe) {
  let total = parseInt(localStorage.getItem("totalUsers")) || 0;
  let active = parseInt(localStorage.getItem("activeUsers")) || 0;
  if (onSubscribe) { total++; active++; } else { active = Math.max(active - 1, 0); }
  localStorage.setItem("totalUsers", total);
  localStorage.setItem("activeUsers", active);
  loadUserStats();
}

// ====== Initialization ======
window.onload=function(){
  loadLists();
  checkStoredSubscription();
  loadUserStats();
  startTimer();
}
</script>
</body>
</html>